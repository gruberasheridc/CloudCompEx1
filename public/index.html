<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Cloud Computing Ex1</title>
</head>
<body>
    <h1>Cloud Computing Ex1</h1>
    <form id        =  "uploadFlie"
          enctype   =  "multipart/form-data"
          action    =  "upload"
          method    =  "post"
            >
        <input type="file" name="Load file" />
        <input type="submit" value="Upload file" name="submit">
    </form>
    <button id="btnCalc" type="button">Calculate</button>
    <ul id="calc"></ul>
    <button id="btnAWSStatus" type="button">Show AWS status button</button>
    <ul id="awsStatus"></ul>
    <button id="btnClearCache" type="button">Clear cache</button>
    <div id="clearCache"></div>
    <button id="btnShowCache" type="button">Show results from cache</button>
    <ul id="showCache"></ul>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
        $("#btnCalc").click(function(event) {
            console.log("btn click!!");
            $.get( "/grades/calc", function(data) {
                parseAndAddGrades(data, "#calc");
            });
        });
    </script>
    <script>
        $("#btnAWSStatus").click(function(event) {
            console.log("btnAWSStatus click!!");
            $.get( "/aws/status", function(data) {
                $( "#awsStatus").empty();
                if (data.length > 0) {
                    for (var i = 0; i < data.length; i++) {
                        var instance = data[i];
                        $("#awsStatus").append("<li>" + "EC2 " +
                            "Type: " + instance["type"] + "." +
                            "Name: " + instance["name"] + "." +
                            " Availability Zone: " + instance["availabilityZone"] + "." +
                            " State: " + instance["state"] + "." +
                        "</li>");
                    }
                } else {
                    $("#awsStatus").text("No instances have been configured!");
                }
            });
        });
    </script>
    <script>
        $("#btnClearCache").click(function(event) {
            console.log("btnClearCache click!!");
            $.get( "/aws/cache/clear", function( data ) {
                $( "#showCache").empty();
                $( "#clearCache").empty();
                $( "#clearCache").text(data);
            });
        });
    </script>
    <script>
        $("#btnShowCache").click(function(event) {
            console.log("btnShowCache click!!");
            $.get( "/grades/cache", function( data ) {
                parseAndAddGrades(data, "#showCache");
            });
        });
    </script>
    <script type="text/javascript">
        function parseAndAddGrades(data, element) {
            $(element).empty();
            if (data.length > 0) {
                for (var i = 0; i < data.length; i++) {
                    var fileGrade = JSON.parse(data[i]);
                    $(element).append("<li>" + "For File " + fileGrade["fileName"] + " the average grade is " + fileGrade["avgGrade"] + "</li>");
                }
            } else {
                $(element).text("No results from cache!");
            }
        }
    </script>
</body>
</html>